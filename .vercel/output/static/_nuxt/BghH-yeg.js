import{_ as L}from"./p7QnFScQ.js";import{_ as Q}from"./MFBl4QUC.js";import{r as b,c as D,o as B,a as x,b as i,k as X,B as Y,w as R,g as n,d as Z,F as ee,l as te,m as oe,C as ae,f as se,A as re,h as ne,D as ie,E as le}from"./BVdw5vJQ.js";import{u as ue}from"./DOzJKxRB.js";import{u as y}from"./BFX_Otd8.js";import{u as pe}from"./CCYVfaL6.js";import{_ as de}from"./D_Ip9zNA.js";import{_ as me}from"./0-e7FVdg.js";import{u as ce,e as fe,r as _e}from"./COQxO7zj.js";import{_ as ve,a as we}from"./BmrZ0j-V.js";import"./BSNo9jaY.js";import"./C4HB1ECi.js";import"./CTp7W1AJ.js";import"./D1CtcXX4.js";import"./DW2cZgo6.js";const ge={class:"flex gap-7 items-center"},ke={class:"px-16 pb-16 pt-9"},xe={__name:"Email",props:{loading:{type:Boolean,default:!1}},emits:["next","back"],setup(E,{expose:$,emit:h}){const a=h,s=b({email:""}),c={email:{required:_e,email:fe}},o=b({}),l=ce(c,s,{$autoDirty:!0,$externalResults:o});async function V(){o.value={},await l.value.$validate()&&a("next",s.value)}return $({setError:u=>o.value=u}),(u,e)=>{var w,p;const f=X,_=de,v=me;return B(),D(ee,null,[x("div",ge,[i(f,{icon:"i-heroicons:arrow-left",variant:"link",onClick:e[0]||(e[0]=d=>a("back"))}),e[2]||(e[2]=x("h3",{class:"text-xl font-normal"},"Reset Password",-1))]),x("div",ke,[x("form",{class:"space-y-6",onSubmit:Y(V,["prevent"])},[i(v,{error:(p=(w=n(l).email.$errors)==null?void 0:w[0])==null?void 0:p.$message},{default:R(()=>[i(_,{modelValue:n(s).email,"onUpdate:modelValue":e[1]||(e[1]=d=>n(s).email=d),placeholder:"Email",size:"lg"},null,8,["modelValue"])]),_:1},8,["error"]),i(f,{type:"submit",loading:E.loading,disabled:n(l).$invalid,block:"",class:"uppercase"},{default:R(()=>[...e[3]||(e[3]=[Z(" Berikutnya ",-1)])]),_:1},8,["loading","disabled"])],32)])],64)}}},ye={class:"bg-white"},Fe={__name:"forgot-password",setup(E){const $=te(),h=oe(),a=b(0),s=b(),c=ue(),{registrationForm:o,token:l,profile:V,tokenCookie:u}=ae(c),e=[{key:"forgot-password",component:xe},{key:"otp",component:ve},{key:"password",component:we}],{execute:f,status:_,error:v}=y("/server/api/forgot-password/request"),{execute:w,status:p,error:d}=y("/server/api/forgot-password/check-otp"),{execute:T,status:z}=y("/server/api/forgot-password/resend-otp",{onResponse({response:r}){r.ok&&s.value.startCountdown()}});function G(){T({email:o.value.email})}const{execute:I,status:P,error:M,data:C}=y("/server/api/forgot-password/reset-password"),{execute:W,status:j}=pe("/server/api/profile",{immediate:!1,onResponse({response:r}){r.ok&&(V.value=r._data.data,c.resetRegistrationForm(),$.runWithContext(()=>{re("/my-account/profile")}))}}),H=se(()=>{switch(e[a.value].key){case"forgot-password":return{loading:_.value==="pending"};case"otp":return{loading:p.value==="pending",loadingResend:z.value==="pending"};case"password":return{loading:P.value==="pending"||j.value==="pending"};default:return{}}});async function J(r,t){var g,k,m,S,N,O,U,q,A,F;switch(r){case"forgot-password":if(await f({email:t.email}),v.value){s.value.setError(((k=(g=v.value.data)==null?void 0:g.meta)==null?void 0:k.validations)||{});return}_.value==="success"&&(o.value.email=t.email,a.value++);break;case"otp":if(await w({email:o.value.email,otp:t.otp}),d.value){s.value.setError((O=(N=(S=(m=d.value.data)==null?void 0:m.meta)==null?void 0:S.validations)==null?void 0:N.otp)==null?void 0:O[0]);return}p.value==="success"&&(o.value.otp=t.otp,a.value++);break;case"password":if(await I({email:o.value.email,otp:o.value.otp,password:t.password,password_confirmation:t.password}),M.value){s.value.setError(((q=(U=error.value.data)==null?void 0:U.meta)==null?void 0:q.validations)||{});return}P.value==="success"&&(o.value.password=t.password,o.value.password_confirmation=t.password,l.value=(A=C.value.data)==null?void 0:A.token,u.value=(F=C.value.data)==null?void 0:F.token,W());break;default:a.value++;break}}function K(r){if(r==="forgot-password")return h.push("/login");a.value--}return(r,t)=>{const g=L,k=Q;return B(),D("section",ye,[i(k,{class:"py-14"},{default:R(()=>[i(g,{class:"max-w-[500px] mx-auto auth-shadow"},{default:R(()=>[(B(),ne(ie(e[n(a)].component),le({ref_key:"formStepElement",ref:s},n(H),{onNext:t[0]||(t[0]=m=>J(e[n(a)].key,m)),onBack:t[1]||(t[1]=m=>K(e[n(a)].key)),onResend:G}),null,16))]),_:1})]),_:1})])}}};export{Fe as default};
